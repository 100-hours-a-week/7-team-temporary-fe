## 16. 일관성 및 유지 보수 규칙

### 16.1 구조 변경 원칙

- 기존 레이어 규칙을 우선한다.
- 예외 구조 도입 시 문서에 근거를 남긴다.

### 16.2 신규 도메인 추가 기준

- entities → features → widgets → pages 순서로 설계한다.
- 임시 구조를 허용하지 않는다.

### 16.3 운영 항목

#### 16.3.1 에러 처리

- 공통 Error Boundary
- 공통 Toast 메시지
- HTTP 상태 코드 기반 사용자 피드백 매핑 (권한/네트워크/서버 구분)
- retry 정책 (401/403/500 분기) 정의
- 2단계 분기: HTTP로 공통 처리 후 `error.status`로 도메인 UX를 결정한다.
  - `401`: AuthService에서 재인증/로그아웃 처리
  - `500`/네트워크 에러: 전역 장애 처리
  - 동일 HTTP라도 `status`가 다르면 다른 UX로 처리
  - 분기 키는 `message`가 아니라 `status`로 고정

#### 16.3.2 데이터 갱신 정책

- 실시간 데이터는 WebSocket(STOMP)/SSE/WebRTC/Polling으로 분리하고 Query는 캐시 기반 조회에 한정한다.

#### 16.3.3 성능 전략

- 코드 스플리팅
- 이미지 최적화
- 불필요한 리렌더 방지

**표준 에러 응답 매핑 예시**

- 서버 `message`는 로그/디버깅 용도로만 사용하고, UI는 표준 메시지를 우선한다.

| HTTP | status                | 프론트 표준 메시지                                        | UX 처리 기준                        |
| ---- | --------------------- | --------------------------------------------------------- | ----------------------------------- |
| 400  | INVALID_REQUEST       | 요청 정보를 확인해 주세요.                                | 폼 필드 오류 또는 토스트            |
| 401  | UNAUTHORIZED          | 세션이 만료되었습니다. 다시 로그인해 주세요.              | AuthService 처리 후 로그아웃/재인증 |
| 403  | FORBIDDEN             | 접근 권한이 없습니다.                                     | 접근 차단 안내                      |
| 404  | PARTICIPANT_NOT_FOUND | 요청한 정보를 찾을 수 없습니다.                           | 리소스 없음 안내                    |
| 409  | CONFLICT              | 요청이 현재 상태와 충돌합니다. 최신 상태를 확인해 주세요. | 입력값/상태 재검증                  |
| 500  | INTERNAL_SERVER_ERROR | 일시적인 오류입니다. 잠시 후 다시 시도해 주세요.          | 장애 안내 및 재시도                 |

#### 16.3.4 문서화

- Storybook을 UI 문서로 활용
  - 설치: `npx storybook@latest init`
  - 실행: `npm run storybook` (또는 패키지 매니저 스크립트)
  - 스토리 위치: 컴포넌트와 동일 폴더에 `*.stories.tsx` 배치
