## 11. Lint / Formatting 정책

### 11.1 도입 도구

- ESLint
- Prettier
- Dependency Cruiser (레이어 의존성 검사)

### 11.2 ESLint 적용 기준

- ESLint는 코드 품질과 구조 규칙을 강제하기 위한 도구로 사용한다.
- 스타일 관련 규칙은 Prettier에 위임하고, ESLint에서는 논리/구조/안전성 규칙만 관리한다.

#### 11.2.1 ESLint 규칙 범위

- 허용
  - 미사용 변수, 잘못된 의존성, 잘못된 hook 사용 감지
  - 잘못된 import 순서 및 레이어 역참조 감지
  - React / TypeScript 권장 규칙

#### 11.2.2 Import 순서 규칙 (Import Order Rules)

- import 순서는 **가독성 및 코드 일관성 확보**를 목적으로 강제한다.
- import 순서 규칙은 **아키텍처 의존성 규칙(FSD)** 과는 분리된 개념으로,
  **참조 가능 여부가 아닌 정렬·배치 기준**만을 다룬다.
- import 순서 강제는 `eslint-plugin-import`의 `import/order` 규칙을 사용한다.

### 적용 목적

- 파일 상단 import 영역의 구조를 일관되게 유지한다.
- 표준화된 import 그룹을 통해 **의존성 성격을 빠르게 파악**할 수 있도록 한다.
- 팀 내 코드 리뷰 시 import 정렬에 대한 논쟁을 제거한다.

### Import 그룹 분류 기준

import 문은 아래 순서를 따른다.

1. **builtin**
   - Node.js 내장 모듈
   - 예: `fs`, `path`

2. **external**
   - npm 패키지
   - 예: `react`, `next`, `zustand`

3. **internal**
   - 프로젝트 내부 절대 경로(alias)
   - 예: `@/shared`, `@/entities`, `@/features`, `@/widgets`, `@/pages`

4. **parent**
   - 상위 디렉터리 상대 경로
   - 예: `../model`, `../lib`

5. **sibling**
   - 동일 디렉터리 상대 경로
   - 예: `./Button`, `./hooks`

6. **index**
   - index 파일 import
   - 예: `./`

7. **object / type**
   - 타입 전용 import (`import type { ... }`)

### 세부 규칙

- 각 import 그룹 사이에는 **빈 줄을 강제**한다.
- 동일 그룹 내 import는 **알파벳 순서**로 정렬한다.
- 절대 경로(alias) import는 `internal` 그룹으로 분류한다.
- 스타일 파일(css/scss)는 가장 마지막에 위치시킨다.

### 예시

```ts
// builtin
import path from "path";

// external
import React from "react";
import { useRouter } from "next/navigation";

// internal
import { Button } from "@/shared/ui";
import { useUser } from "@/entities/user";

// parent
import { useLogic } from "../model/useLogic";

// sibling
import { Header } from "./Header";

// style
import "./styles.css";
```

### 적용 정책

- import 순서 규칙 위반은 **ESLint error**로 처리한다.
- 자동 수정이 가능한 경우 `--fix` 옵션을 통해 정렬한다.
- 예외 케이스는 원칙적으로 허용하지 않는다.

---

### ESLint 설정 근거 명시용

> import 순서 규칙은 구조적 의존성(FSD) 검증과 분리하여 관리하며,
> 코드 가독성과 유지보수성을 높이기 위한 정렬 규칙으로만 사용한다.

#### 11.2.3 적용 정책

- 로컬 개발 환경에서 ESLint 경고를 즉시 확인할 수 있도록 설정한다.
- CI 단계에서 ESLint error 발생 시 빌드를 실패시킨다.
- warning은 점진적으로 정리하되, 신규 코드에는 error 기준을 적용한다.

#### 11.2.4 규칙 관리 원칙

- 규칙 추가/변경 시 반드시 **의도와 근거를 문서로 남긴다.**
- 일시적인 예외는 **eslint-disable 주석으로 명시하고, 사유를 함께 작성한다.**
- 전역 disable은 원칙적으로 금지한다.

### 11.3 Prettier / Formatting 기준

- 저장 시 **자동 포맷**을 기본으로 한다.
- 코드 스타일 논쟁을 방지하기 위해 포맷 기준을 단일화한다.

### 11.4 품질 유지 전략

- CI 단계에서 lint 실패 시 빌드 차단
- 레이어 의존성 규칙 위반 시 빌드 실패를 허용한다.

### 11.5 FSD 아키텍처 기반 ESLint Rule 설계

- ESLint는 FSD 아키텍처의 레이어 의존성 규칙을 코드 레벨에서 강제하는 용도로 사용한다.
- 레이어 역참조 및 slice 간 잘못된 의존성을 사전에 차단한다.
- **레이어 의존성 규칙**
  - shared는 다른 레이어를 참조하지 않는다.
  - shared 내부는 목적별 세그먼트(ui, lib, api, styles 등)로 구분하여 관리한다.
  - entities는 shared만 참조할 수 있다.
  - features는 entities, shared만 참조할 수 있다.
  - widgets는 features, entities, shared를 참조할 수 있다.
  - pages는 widgets, features, entities, shared를 조합한다.
  - 상위 레이어를 하위 레이어에서 참조하는 것을 금지한다.
- **규칙 상세**
  - 레이어 매핑 기준
    - `shared`: `src/shared/**`
    - `entities`: `src/entities/**`
    - `features`: `src/features/**`
    - `widgets`: `src/widgets/**`
    - `pages`: `src/pages/**`
  - slice 경계 규칙
    - 다른 slice의 직접 참조 및 간접 참조(순환 의존)를 모두 금지한다.
    - slice 외부에서의 접근은 반드시 해당 slice의 `index.ts`(public API)를 통해서만 허용한다.
    - 동일 slice 내부는 상대 경로 import를 허용한다.
    - app 레이어는 다른 모든 레이어를 조합하는 진입점이다.
    - app은 하위 레이어(shared, entities, features, widgets, pages)를 참조할 수 있다.
    - 다른 모든 레이어는 app 레이어를 참조할 수 없다.
- **적용 원칙**
  - 규칙 위반은 ESLint error로 처리한다.
  - 일시적인 예외는 허용하지 않는다.
  - 구조적 검증은 Dependency Cruiser와 병행하여 수행한다.
- FSD 레이어 의존성 규칙은 **ESLint(boundaries)**와
  **Dependency Cruiser**를 통해 검증한다.

### 11.6 ESLint / Prettier 추천 구성

**ESLint**

| 구분      | 항목                                         | 추천값/설명                                            |
| --------- | -------------------------------------------- | ------------------------------------------------------ |
| 프리셋    | `eslint-config-next`                         | Next.js 공식 권장 (core-web-vitals 포함)               |
| 프리셋    | `plugin:prettier/recommended`                | Prettier 충돌 rule off + `prettier/prettier` 검사 강제 |
| 플러그인  | `@typescript-eslint/eslint-plugin`           | TS 규칙 강화                                           |
| 플러그인  | `eslint-plugin-react-hooks`                  | hooks 규칙 강제                                        |
| 플러그인  | `eslint-plugin-import`                       | import 순서/정리                                       |
| 플러그인  | `eslint-plugin-unused-imports`               | 미사용 import/변수 제거                                |
| 플러그인  | `eslint-plugin-storybook`                    | Storybook 사용 시                                      |
| 옵션/규칙 | `@typescript-eslint/no-explicit-any`         | `warn`                                                 |
| 옵션/규칙 | `@typescript-eslint/consistent-type-imports` | `warn`                                                 |
| 옵션/규칙 | `unused-imports/no-unused-imports`           | `error`                                                |
| 옵션/규칙 | `react-hooks/exhaustive-deps`                | `warn`                                                 |

설정

| 항목        | 값                                            | 설명                                    |
| ----------- | --------------------------------------------- | --------------------------------------- |
| env/globals | `browser`, `node`                             | 브라우저/Node 전역 변수를 정상으로 인정 |
| ignore      | `node_modules/*`, `dist/`, `.vite/`, `.next/` | 검사 제외                               |
| files       | `**/*.{ts, tsx, js, jsx}`                     | 검사 대상 확장자                        |

**Prettier**

| 옵션                   | 값                              | 설명                                       |
| ---------------------- | ------------------------------- | ------------------------------------------ |
| semi                   | true                            | 세미콜론 사용                              |
| singleQuote            | false                           | 문자열은 큰따옴표 사용 (작은따옴표도 허용) |
| plugins                | ["prettier-plugin-tailwindcss"] | Tailwind class 자동 정렬                   |
| bracketSpacing         | true                            | `{ foo: bar }` 형태 유지                   |
| bracketSameLine        | false                           | 멀티라인 JSX 닫는 꺾쇠를 새 줄에 배치      |
| printWidth             | 100                             | 줄 길이                                    |
| tabWidth               | 2                               | 들여쓰기 폭                                |
| singleAttributePerLine | true                            | JSX props를 한 줄에 하나씩 표시            |
| trailingComma          | all                             | 멀티라인 후행 쉼표 추가                    |
| endOfLine              | auto                            | OS 개행 차이로 인한 diff 방지              |

### 11.7 Dependency Cruiser 설정 기준

- 설정 파일: `dependency-cruiser.js`
- 검사 대상: `src/**`
- 제외 대상: `node_modules`, `.next`, `dist`, `**/*.stories.tsx`
- 출력: CI에서는 텍스트 리포트, 로컬에서는 graph 사용을 허용한다.
- 레이어 의존성 규칙은 ESLint(boundaries)와 동일한 규칙을 사용한다.
- 사용 이유: FSD 원칙 준수 여부와 레이어 의존성 위반을 자동 검증하기 위함이다.

권장 규칙 예시

```js
module.exports = {
  forbidden: [
    {
      name: "no-shared-deps",
      from: { path: "^src/shared" },
      to: { path: "^src/(entities|features|widgets|pages)" },
    },
    {
      name: "no-entities-deps",
      from: { path: "^src/entities" },
      to: { path: "^src/(features|widgets|pages)" },
    },
    {
      name: "no-features-deps",
      from: { path: "^src/features" },
      to: { path: "^src/(widgets|pages)" },
    },
    {
      name: "no-widgets-deps",
      from: { path: "^src/widgets" },
      to: { path: "^src/pages" },
    },
  ],
};
```

### 11.8 자동화

- pre-commit: `prettier --write` + `eslint --fix` (lint-staged로 변경 파일만)
- CI(PR): `lint` + `typecheck` + `test` + `build`

---
